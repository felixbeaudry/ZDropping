}
save(simAlleleFreq,file="working_files/intermediate_files/simAlleleFreqA.rdata")
#load("simAlleleFreqA_11Mar2021.rdata")
####calculate variances and covariances####
simVar<-data.frame(Year=rep(c(1999:2013),each=112),Category=rep(c(
'pt1-pt',
'pMs-pt','xMs-xt','errMS-errT','pMspterrMSerrT',
'pFs-pt','xFs-xt','errFS-errT','pFspterrFSerrT',
'pMi-pt','xMi-xt','errMI-errT','pMipterrMIerrT',
'pFi-pt','xFi-xt','errFI-errT','pFipterrFIerrT',
'pMb-pt','xMb-xt','errMB-errT','pMbpterrMBerrT',
'pFb-pt','xFb-xt','errFB-errT','pFbpterrFBerrT',
'pMspMi','xMsxMi','xMserrMI','errMSxMi','errMSerrMI',
'pMspMb','xMsxMb','xMserrMB','errMSxMb','errMSerrMB',
'pMipMb','xMixMb','xMierrMB','errMIxMb','errMIerrMB',
'pFspFi','xFsxFi','xFserrFI','errFSxFi','errFSerrFI',
'pFspFb','xFsxFb','xFserrFB','errFSxFb','errFSerrFB',
'pFipFb','xFixFb','xFierrFB','errFIxFb','errFIerrFB',
'pMspFs','xMsxFs','xMserrFS','errMSxFs','errMSerrFS',
'pMipFi','xMixFi','xMierrFI','errMIxFi','errMIerrFI',
'pMbpFb','xMbxFb','xMberrFB','errMBxFb','errMBerrFB',
'pMspFi','xMsxFi','xMserrFI','errMSxFi','errMSerrFI',
'pMspFb','xMsxFb','xMserrFB','errMSxFb','errMSerrFB',
'pMipFb','xMixFb','xMierrFB','errMIxFb','errMIerrFB',
'pFspMi','xFsxMi','xFserrMI','errFSxMi','errFSerrMI',
'pFspMb','xFsxMb','xFserrMB','errFSxMb','errFSerrMB',
'pFipMb','xFixMb','xFierrMB','errFIxMb','errFIerrMB',
'pMmend','xMmend','errMMEND','pMfam-pt','xMfam-xt','errMFAM-errT',
'pFmend','xFmend','errFMEND','pFfam-pt','xFfam-xt','errFFAM-errT')
,15),stringsAsFactors=FALSE)
bsYr<-simVar$Year
bsCat<-simVar$Category
for(year in c(1999:2013)){
#total variance, for males and females
simVar[bsYr==year & bsCat=='pt1-pt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pt1-pt',c(3:(nloci+2))])^2)
#variance for each category, for males and females
#survivors
simVar[bsYr==year & bsCat=='pMs-pt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMs-pt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='xMs-xt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMs-xt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='errMS-errT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMS-errT',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='pMspterrMSerrT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMs-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMS-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='pFs-pt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFs-pt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='xFs-xt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFs-xt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='errFS-errT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFS-errT',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='pFspterrFSerrT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFs-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFS-errT',c(3:(nloci+2))]))
#imms
simVar[bsYr==year & bsCat=='pMi-pt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMi-pt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='xMi-xt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMi-xt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='errMI-errT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMI-errT',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='pMipterrMIerrT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMi-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMI-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='pFi-pt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFi-pt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='xFi-xt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFi-xt',3:(nloci+2)])^2)
simVar[bsYr==year & bsCat=='errFI-errT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFI-errT',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='pFipterrFIerrT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFi-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFI-errT',c(3:(nloci+2))]))
#births
simVar[bsYr==year & bsCat=='pMb-pt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMb-pt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='xMb-xt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMb-xt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='errMB-errT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMB-errT',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='pMbpterrMBerrT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMb-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='pFb-pt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFb-pt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='xFb-xt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFb-xt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='errFB-errT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFB-errT',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='pFbpterrFBerrT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFb-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFB-errT',c(3:(nloci+2))]))
#covariance between categories - males
simVar[bsYr==year & bsCat=='pMspMi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMs-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMi-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMsxMi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMi-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMserrMI',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMI-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMSxMi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMi-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMSerrMI',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMI-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='pMspMb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMs-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMb-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMsxMb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMserrMB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMSxMb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMSerrMB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='pMipMb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMi-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMb-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMixMb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMi-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMierrMB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMi-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMIxMb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMI-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMIerrMB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMI-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMB-errT',c(3:(nloci+2))]))
#covariance between categories - females
simVar[bsYr==year & bsCat=='pFspFi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFs-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFi-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xFsxFi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFi-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xFserrFI',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFI-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errFSxFi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFi-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errFSerrFI',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFI-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='pFspFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFs-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFb-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xFsxFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xFserrFB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errFSxFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errFSerrFB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='pFipFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFi-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFb-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xFixFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFi-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xFierrFB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFi-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errFIxFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFI-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errFIerrFB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFI-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFB-errT',c(3:(nloci+2))]))
#covariance between males and females within a category
#survivors
simVar[bsYr==year & bsCat=='pMspFs',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMs-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFs-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMsxFs',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFs-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMserrFS',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFS-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMSxFs',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFs-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMSerrFS',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFS-errT',c(3:(nloci+2))]))
#imms
simVar[bsYr==year & bsCat=='pMipFi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMi-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFi-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMixFi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMi-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFi-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMierrFI',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMi-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFI-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMIxFi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMI-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFi-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMIerrFI',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMI-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFI-errT',c(3:(nloci+2))]))
#births
simVar[bsYr==year & bsCat=='pMbpFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMb-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFb-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMbxFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMb-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMberrFB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMb-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMBxFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMB-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMBerrFB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMB-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFB-errT',c(3:(nloci+2))]))
#covariance between males and females in different categories
simVar[bsYr==year & bsCat=='pMspFi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMs-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFi-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMsxFi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFi-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMserrFI',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFI-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMSxFi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFi-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMSerrFI',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFI-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='pMspFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMs-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFb-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMsxFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMserrFB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMSxFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMSerrFB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='pMipFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMi-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFb-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMixFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMi-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xMierrFB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMi-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMIxFb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMI-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errMIerrFB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMI-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='pFspMi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFs-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMi-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xFsxMi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMi-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xFserrMI',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMI-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errFSxMi',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMi-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errFSerrMI',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMI-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='pFspMb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFs-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMb-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xFsxMb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xFserrMB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFs-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errFSxMb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errFSerrMB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFS-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='pFipMb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFi-pt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMb-pt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xFixMb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFi-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='xFierrMB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFi-xt',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMB-errT',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errFIxMb',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFI-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMb-xt',c(3:(nloci+2))]))
simVar[bsYr==year & bsCat=='errFIerrMB',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFI-errT',c(3:(nloci+2))])*
as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMB-errT',c(3:(nloci+2))]))
#variance for mendelian segregation and family size
#males
simVar[bsYr==year & bsCat=='pMmend',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMmend',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='xMmend',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMmend',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='errMMEND',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMMEND',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='pMfam-pt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pMfam-pt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='xMfam-xt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xMfam-xt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='errMFAM-errT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errMFAM-errT',c(3:(nloci+2))])^2)
#females
simVar[bsYr==year & bsCat=='pFmend',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFmend',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='xFmend',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFmend',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='errFMEND',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFMEND',c(3:(nloci+2))])^2)
#as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFMEND',c(3:(10+2))])^2
simVar[bsYr==year & bsCat=='pFfam-pt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pFfam-pt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='xFfam-xt',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='xFfam-xt',c(3:(nloci+2))])^2)
simVar[bsYr==year & bsCat=='errFFAM-errT',3]<-
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='errFFAM-errT',c(3:(nloci+2))])^2)
}
simVar
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pt1-pt',c(3:(nloci+2))])^2)
year
year=1999
mean(as.numeric(simAlleleFreq[frqYr==year & frqCat=='pt1-pt',c(3:(nloci+2))])^2)
simAlleleFreq[frqYr==year & frqCat=='pt1-pt',c(3:(nloci+2))]
simAlleleFreq[frqYr==year & frqCat=='pt',c(3:(nloci+2))]
simAlleleFreq[frqYr==year & frqCat=='pt',c(3:(nloci+2))]
simAlleleFreq[frqYr==(year-1) & frqCat=='pt',c(3:(nloci+2))]
sum(simdataTrue[simdataTrue$Year==year,i],na.rm=TRUE)/
((2*sum(!is.na(simdataTrue[simdataTrue$Year==year&simdataTrue$Sex==1,i])))
+(2*sum(!is.na(simdataTrue[simdataTrue$Year==year&simdataTrue$Sex==2,i]))))
sim1
simAlleleFreq
year<-1998
sim<-foreach(i=names(simdataTrue)[8:(nloci+7)],.combine=cbind) %do% {
#create data frame to hold allele freqs & error
tmp<-data.frame(Year=rep(year,each=3),Category=c('pt','xt','errT'),
stringsAsFactors=FALSE)
frqYr1<-tmp$Year
frqCat1<-tmp$category
tmp[frqYr1==year & frqCat1=='pt',3]<-
sum(simdataTrue[simdataTrue$Year==year,i],na.rm=TRUE)/
((2*sum(!is.na(simdataTrue[simdataTrue$Year==year&simdataTrue$Sex==1,i])))
+(2*sum(!is.na(simdataTrue[simdataTrue$Year==year&simdataTrue$Sex==2,i]))))
tmp[frqYr1==year & frqCat1=='xt',3]<-
sum(simdataSample[simdataSample$Year==year,i],na.rm=TRUE)/
((2*sum(!is.na(simdataSample[simdataSample$Year==year&simdataSample$Sex==1,i])))
+(2*sum(!is.na(simdataSample[simdataSample$Year==year&simdataSample$Sex==2,i]))))
tmp[,3]
}
sim
year<-1998
sim<-foreach(i=names(simdataTrue)[8:(nloci+7)],.combine=cbind) %do% {
#create data frame to hold allele freqs & error
tmp<-data.frame(Year=rep(year,each=3),Category=c('pt','xt','errT'),
stringsAsFactors=FALSE)
frqYr1<-tmp$Year
frqCat1<-tmp$Category
tmp[frqYr1==year & frqCat1=='pt',3]<-
sum(simdataTrue[simdataTrue$Year==year,i],na.rm=TRUE)/
((2*sum(!is.na(simdataTrue[simdataTrue$Year==year&simdataTrue$Sex==1,i])))
+(2*sum(!is.na(simdataTrue[simdataTrue$Year==year&simdataTrue$Sex==2,i]))))
tmp[frqYr1==year & frqCat1=='xt',3]<-
sum(simdataSample[simdataSample$Year==year,i],na.rm=TRUE)/
((2*sum(!is.na(simdataSample[simdataSample$Year==year&simdataSample$Sex==1,i])))
+(2*sum(!is.na(simdataSample[simdataSample$Year==year&simdataSample$Sex==2,i]))))
tmp[,3]
}
sim
load("working_files/intermediate_files/allVar_boot_A_w3.4mb.rdata") #bootstrap
View(allVar)
library(plyr)
library(tidyr)
library(foreach)
library(dplyr)
library(doParallel)
library(data.table)
`%notin%` <- Negate(`%in%`)
##
load(file='working_files/intermediate_files/indivlistgeno_A.rdata')
indivlistgeno <- indivlistgeno_A
#Z SNP info
map<-read.table('working_files/FSJfullPedFiltDogFINAL12July2016finalSexNumMAF05geno.map')
ASNPS <- map[map$V1 %in% c(0:38),]
ASNPS$SNP_name <- names(indivlistgeno_A[,-c(1:8)])
ASNPS <- ASNPS[ASNPS$V1 %in% c(1:38),]
ASNPS$map_pos <- seq(1,length(ASNPS$V1))
chip <- fread('working_files/FSJbeadchipSeqLocFSJgenomeV2_06May2021.txt',fill=TRUE,header=TRUE)
ASNPS_chip <- left_join(ASNPS,chip,by=c("V2"="SNPname"))
sizes <- fread('working_files/FSJ.chrom.sizes')
#which scaffolds to keep
sizes <- sizes[sizes$V1 %in% c(
"ScYP8k313HRSCAF58ch1"   , "ScYP8k312HRSCAF54ch1A"   , "ScYP8k3629HRSCAF770ch2" ,  "ScYP8k3866HRSCAF1020ch3" , "ScYP8k311HRSCAF50ch4","ScYP8k314HRSCAF84ch4A"  ,
"ScYP8k39HRSCAF32ch6" , "ScYP8k35HRSCAF18ch5"     , "ScYP8k34HRSCAF13ch7"   , "ScYP8k31HRSCAF1ch8"   ,  "ScYP8k33HRSCAF8ch9" , "ScYP8k32HRSCAF3ch10"   ,
"ScYP8k3869HRSCAF1023ch11",  "ScYP8k3870HRSCAF1029ch12",  "ScYP8k3302HRSCAF431ch13"  , "ScYP8k3651HRSCAF793ch14" ,  "ScYP8k3864HRSCAF1010ch15",
"ScYP8k37HRSCAF29ch17"   , "ScYP8k38HRSCAF31ch18"  ,  "ScYP8k36HRSCAF25ch19" ,"ScYP8k3865HRSCAF1011ch20",   "ScYP8k369HRSCAF175ch21" ,   "ScYP8k369HRSCAF175ch22"  ,
"ScYP8k369HRSCAF175ch23",  "ScYP8k369HRSCAF175ch24" , "ScYP8k369HRSCAF175ch25" ,"ScYP8k369HRSCAF175ch26", "ScYP8k369HRSCAF175ch27"  , "ScYP8k369HRSCAF175ch28")]
w_size = 3400000
nloci<- 5000 #set sim loci number relative to window size; regular sim nloci / genome size in mb
#loop across scaffolds making windows of SNPs
win_global = 0
#lg = "ScYP8k313HRSCAF58ch1"
for(lg in unique(sizes$V1)){
size_tmp <- sizes$V2[sizes$V1 == lg]
#loop across windows
for(win in seq(from=0,to=max(ASNPS_chip$SNPpos[ASNPS_chip$NewScaff == lg],na.rm=T),by = w_size)){
if(win+w_size<size_tmp){
cat(lg," ", ((win/w_size) + win_global)," ",win," ",size_tmp,"\n")
ASNPS_chip$bootstrap[ASNPS_chip$SNPpos > win & ASNPS_chip$SNPpos <= (win+w_size) & ASNPS_chip$NewScaff == lg] <- (win/w_size) + win_global
}else{ #skip windows at the end of scaffolds with too few SNPs
cat(lg," ", ((win/w_size) + win_global)," ",win," ",size_tmp," skipped\n")
}
}
win_global <- (win/w_size) + win_global #need to increase window number with each loop across chromosomes
}
markersInPedOrder_chip_A <- ASNPS_chip[,c(5,12,7)]
names(markersInPedOrder_chip_A)[1]<- "SNP"
#remove low SNP bootstraps
markersInPedOrder_chip_A_tally <- markersInPedOrder_chip_A %>% group_by(bootstrap) %>% tally()
big_boots <- markersInPedOrder_chip_A_tally$bootstrap[markersInPedOrder_chip_A_tally$n >= 5]
markersInPedOrder_chip_A <- markersInPedOrder_chip_A[markersInPedOrder_chip_A$bootstrap %in% big_boots,]
#set constants
simindivlist <- indivlistgeno[order(indivlistgeno$Year),c(1:6,8)]
colnames(simindivlist) <- c( "Year","Indiv", "Category", "Genotyped", "Mom", "Dad", "Sex")
simindivgeno<-simindivlist[!duplicated(simindivlist$Indiv),]
colnames(simindivgeno) <- c( "Year","Indiv", "Category", "Genotyped", "Mom", "Dad", "Sex")
#separate into moms vs dads vs nestlings
simindivgenoMoms<-
simindivgeno[(simindivgeno$Category!='nestling' | is.na(simindivgeno$Mom)) & simindivgeno$Sex==2,]
simindivgenoDads<-
simindivgeno[(simindivgeno$Category!='nestling' | is.na(simindivgeno$Mom)) & simindivgeno$Sex==1,]
simindivgenoNestlings<-
simindivgeno[simindivgeno$Category=='nestling' & !is.na(simindivgeno$Mom),]
allVar <-
rbind.data.frame(
data.frame(Year=rep(c(1999:2013),each=28),Category=rep(c(
'xt1-xt',
'xMs-xt','xFs-xt',
'xMi-xt','xFi-xt',
'xMb-xt','xFb-xt',
'xMsxMi','xFsxFi','xMsxMb','xFsxFb','xMixMb','xFixFb',
'xMsxFs','xMixFi','xMbxFb',
'xMsxFi','xMsxFb','xMixFb',
'xFsxMi','xFsxMb','xFixMb',
'xMfam','xFfam','xMmend','xFmend','xMfam-xt','xFfam-xt'),15),stringsAsFactors=FALSE)
,
data.frame(Year=rep(c(1999:2013),each=112),Category=rep(c(
'pt1-pt',
'pMs-pt','sxMs-xt','errMS-errT','pMspterrMSerrT',
'pFs-pt','sxFs-xt','errFS-errT','pFspterrFSerrT',
'pMi-pt','sxMi-xt','errMI-errT','pMipterrMIerrT',
'pFi-pt','sxFi-xt','errFI-errT','pFipterrFIerrT',
'pMb-pt','sxMb-xt','errMB-errT','pMbpterrMBerrT',
'pFb-pt','sxFb-xt','errFB-errT','pFbpterrFBerrT',
'pMspMi','sxMsxMi','sxMserrMI','errMSxMi','errMSerrMI',
'pMspMb','sxMsxMb','sxMserrMB','errMSxMb','errMSerrMB',
'pMipMb','sxMixMb','sxMierrMB','errMIxMb','errMIerrMB',
'pFspFi','sxFsxFi','sxFserrFI','errFSxFi','errFSerrFI',
'pFspFb','sxFsxFb','sxFserrFB','errFSxFb','errFSerrFB',
'pFipFb','sxFixFb','sxFierrFB','errFIxFb','errFIerrFB',
'pMspFs','sxMsxFs','sxMserrFS','errMSxFs','errMSerrFS',
'pMipFi','sxMixFi','sxMierrFI','errMIxFi','errMIerrFI',
'pMbpFb','sxMbxFb','sxMberrFB','errMBxFb','errMBerrFB',
'pMspFi','sxMsxFi','sxMserrFI','errMSxFi','errMSerrFI',
'pMspFb','sxMsxFb','sxMserrFB','errMSxFb','errMSerrFB',
'pMipFb','sxMixFb','sxMierrFB','errMIxFb','errMIerrFB',
'pFspMi','sxFsxMi','sxFserrMI','errFSxMi','errFSerrMI',
'pFspMb','sxFsxMb','sxFserrMB','errFSxMb','errFSerrMB',
'pFipMb','sxFixMb','sxFierrMB','errFIxMb','errFIerrMB',
'pMmend','sxMmend','errMMEND','pMfam-pt','sxMfam-xt','errMFAM-errT',
'pFmend','sxFmend','errFMEND','pFfam-pt','sxFfam-xt','errFFAM-errT')
,15),stringsAsFactors=FALSE)
)
####start the loop####
unique(na.omit(markersInPedOrder_chip_A$bootstrap))
load("working_files/intermediate_files/allVar_boot_A_w3.4mb.rdata") #bootstrap
