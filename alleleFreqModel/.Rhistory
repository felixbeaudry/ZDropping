+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errMSerrFS','q5'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MSFS','q95']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMS']*prop[yr,'propFS'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xMsxFs','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxMserrFS','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errMSxFs','q95']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errMSerrFS','q95'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MIFI','avg']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMI']*prop[yr,'propFI'])*
(sampleVar[sampleVar$Year==x & sampleVar$Category=='xMixFi','avg']
- simVar[simVar$Year==x & simVar$Category=='xMierrFI',3]
- simVar[simVar$Year==x & simVar$Category=='errMIxFi',3]
+ simVar[simVar$Year==x & simVar$Category=='errMIerrFI',3])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MIFI','q5']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMI']*prop[yr,'propFI'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xMixFi','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxMierrFI','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errMIxFi','q5']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errMIerrFI','q5'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MIFI','q95']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMI']*prop[yr,'propFI'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xMixFi','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxMierrFI','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errMIxFi','q95']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errMIerrFI','q95'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MBFB','avg']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMB']*prop[yr,'propFB'])*
(sampleVar[sampleVar$Year==x & sampleVar$Category=='xMbxFb','avg']
- simVar[simVar$Year==x & simVar$Category=='xMberrFB',3]
- simVar[simVar$Year==x & simVar$Category=='errMBxFb',3]
+ simVar[simVar$Year==x & simVar$Category=='errMBerrFB',3])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MBFB','q5']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMB']*prop[yr,'propFB'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xMbxFb','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxMberrFB','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errMBxFb','q5']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errMBerrFB','q5'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MBFB','q95']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMB']*prop[yr,'propFB'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xMbxFb','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxMberrFB','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errMBxFb','q95']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errMBerrFB','q95'])
})
#MF - different categories
#M then F
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MSFI','avg']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMS']*prop[yr,'propFI'])*
(sampleVar[sampleVar$Year==x & sampleVar$Category=='xMsxFi','avg']
- simVar[simVar$Year==x & simVar$Category=='xMserrFI',3]
- simVar[simVar$Year==x & simVar$Category=='errMSxFi',3]
+ simVar[simVar$Year==x & simVar$Category=='errMSerrFI',3])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MSFI','q5']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMS']*prop[yr,'propFI'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xMsxFi','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxMserrFI','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errMSxFi','q5']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errMSerrFI','q5'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MSFI','q95']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMS']*prop[yr,'propFI'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xMsxFi','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxMserrFI','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errMSxFi','q95']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errMSerrFI','q95'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MSFB','avg']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMS']*prop[yr,'propFB'])*
(sampleVar[sampleVar$Year==x & sampleVar$Category=='xMsxFb','avg']
- simVar[simVar$Year==x & simVar$Category=='xMserrFB',3]
- simVar[simVar$Year==x & simVar$Category=='errMSxFb',3]
+ simVar[simVar$Year==x & simVar$Category=='errMSerrFB',3])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MSFB','q5']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMS']*prop[yr,'propFB'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xMsxFb','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxMserrFB','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errMSxFb','q5']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errMSerrFB','q5'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MSFB','q95']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMS']*prop[yr,'propFB'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xMsxFb','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxMserrFB','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errMSxFb','q95']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errMSerrFB','q95'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MIFB','avg']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMI']*prop[yr,'propFB'])*
(sampleVar[sampleVar$Year==x & sampleVar$Category=='xMixFb','avg']
- simVar[simVar$Year==x & simVar$Category=='xMierrFB',3]
- simVar[simVar$Year==x & simVar$Category=='errMIxFb',3]
+ simVar[simVar$Year==x & simVar$Category=='errMIerrFB',3])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MIFB','q5']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMI']*prop[yr,'propFB'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xMixFb','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxMierrFB','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errMIxFb','q5']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errMIerrFB','q5'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='MIFB','q95']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propMI']*prop[yr,'propFB'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xMixFb','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxMierrFB','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errMIxFb','q95']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errMIerrFB','q95'])
})
#F then M
alleleFreqVarAvg[alleleFreqVarAvg$Category=='FSMI','avg']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propFS']*prop[yr,'propMI'])*
(sampleVar[sampleVar$Year==x & sampleVar$Category=='xFsxMi','avg']
- simVar[simVar$Year==x & simVar$Category=='xFserrMI',3]
- simVar[simVar$Year==x & simVar$Category=='errFSxMi',3]
+ simVar[simVar$Year==x & simVar$Category=='errFSerrMI',3])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='FSMI','q5']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propFS']*prop[yr,'propMI'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xFsxMi','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxFserrMI','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errFSxMi','q5']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errFSerrMI','q5'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='FSMI','q95']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propFS']*prop[yr,'propMI'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xFsxMi','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxFserrMI','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errFSxMi','q95']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errFSerrMI','q95'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='FSMB','avg']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propFS']*prop[yr,'propMB'])*
(sampleVar[sampleVar$Year==x & sampleVar$Category=='xFsxMb','avg']
- simVar[simVar$Year==x & simVar$Category=='xFserrMB',3]
- simVar[simVar$Year==x & simVar$Category=='errFSxMb',3]
+ simVar[simVar$Year==x & simVar$Category=='errFSerrMB',3])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='FSMB','q5']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propFS']*prop[yr,'propMB'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xFsxMb','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxFserrMB','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errFSxMb','q5']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errFSerrMB','q5'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='FSMB','q95']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propFS']*prop[yr,'propMB'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xFsxMb','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxFserrMB','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errFSxMb','q95']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errFSerrMB','q95'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='FIMB','avg']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propFI']*prop[yr,'propMB'])*
(sampleVar[sampleVar$Year==x & sampleVar$Category=='xFixMb','avg']
- simVar[simVar$Year==x & simVar$Category=='xFierrMB',3]
- simVar[simVar$Year==x & simVar$Category=='errFIxMb',3]
+ simVar[simVar$Year==x & simVar$Category=='errFIerrMB',3])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='FIMB','q5']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propFI']*prop[yr,'propMB'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xFixMb','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxFierrMB','q5']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errFIxMb','q5']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errFIerrMB','q5'])
})
alleleFreqVarAvg[alleleFreqVarAvg$Category=='FIMB','q95']<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
2*(prop[yr,'propFI']*prop[yr,'propMB'])*
(allVar_q[allVar_q$Year==x & allVar_q$Category=='xFixMb','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='sxFierrMB','q95']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errFIxMb','q95']
+ allVar_q[allVar_q$Year==x & allVar_q$Category=='errFIerrMB','q95'])
})
#Mend and Fam
mendMAvg<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
((prop[yr,'propMB'])^2)*(sampleVar[sampleVar$Year==x & sampleVar$Category=='xMmend',3]
- simVar[simVar$Year==x & simVar$Category=='errMMEND',3])
})
famMAvg<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
((prop[yr,'propMB'])^2)*(sampleVar[sampleVar$Year==x & sampleVar$Category=='xMfam-xt',3]
- simVar[simVar$Year==x & simVar$Category=='errMFAM-errT',3])
})
# females
mendFAvg<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
((prop[yr,'propFB'])^2)*(sampleVar[sampleVar$Year==x & sampleVar$Category=='xFmend',3]
- simVar[simVar$Year==x & simVar$Category=='errFMEND',3])
})
famFAvg<-laply(c(2000:2013), function(x) {
yr<-as.character(x)
((prop[yr,'propFB'])^2)*(sampleVar[sampleVar$Year==x & sampleVar$Category=='xFfam-xt',3]
- simVar[simVar$Year==x & simVar$Category=='errFFAM-errT',3])
})
newBsq_Z <-rbind(data.frame(Year=c(2000:2013),Category=rep('MBsq_mend',14),
avg=mendMAvg,stringsAsFactors=FALSE),
data.frame(Year=c(2000:2013),Category=rep('MBsq_fam',14),
avg=famMAvg,stringsAsFactors=FALSE),
data.frame(Year=c(2000:2013),Category=rep('FBsq_mend',14),
avg=mendFAvg,stringsAsFactors=FALSE),
data.frame(Year=c(2000:2013),Category=rep('FBsq_fam',14),
avg=famFAvg,stringsAsFactors=FALSE))
####normalize Z terms####
alleleFreqVarAvg2<-alleleFreqVarAvg[
alleleFreqVarAvg$Category != 'MSMI'
& alleleFreqVarAvg$Category != 'FSFI'
& alleleFreqVarAvg$Category != 'MSFI'
& alleleFreqVarAvg$Category != 'FSMI'
# Remove immigrant covariance and mom-daughter Z inheritance
& alleleFreqVarAvg$Category != 'FIFB'
& alleleFreqVarAvg$Category != 'FSFB',]
# Find sum for each year and calculate proportion for each Category
alleleFreqVarAvg2$sum<-laply(alleleFreqVarAvg2$Year,function(x)   sum(alleleFreqVarAvg2[alleleFreqVarAvg2$Year==x,'avg']))
alleleFreqVarAvg2$sum_abs<-laply(alleleFreqVarAvg2$Year,function(x)   sum(abs(alleleFreqVarAvg2[alleleFreqVarAvg2$Year==x,'avg'])))
alleleFreqVarAvg2$prop<-alleleFreqVarAvg2$avg/alleleFreqVarAvg2$sum
alleleFreqVarAvg2$q5_prop <- alleleFreqVarAvg2$q5 / alleleFreqVarAvg2$sum
alleleFreqVarAvg2$q95_prop <- alleleFreqVarAvg2$q95 / alleleFreqVarAvg2$sum
##obs v exp
Z_obsDiff <- laply(c(2000:2013), function(x) {
yr<-as.character(x)
cbind(yr,(sampleVar[sampleVar$Year==x & sampleVar$Category=='xt1-xt','avg']
- simVar[simVar$Year==x & simVar$Category=='errt1-errt',3]
- 2*simVar[simVar$Year==x & simVar$Category=='pt1pterrt1errT',3]))
})
Z_obsDiff <- as.data.frame(Z_obsDiff)
Z_obsDiff$yr <- as.numeric(Z_obsDiff$yr)
Z_obsDiff$V2 <- as.numeric(Z_obsDiff$V2)
Z_obsDiff_bootmed <- laply(c(2000:2013), function(x) {
yr<-as.character(x)
cbind(yr,(allVar_q[allVar_q$Year==x & allVar_q$Category=='xt1-xt','median']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errt1-errt','median']
- 2*allVar_q[simVar$Year==x & allVar_q$Category=='pt1pterrt1errT','median']))
})
Z_obsDiff_bootmed <- as.data.frame(Z_obsDiff_bootmed)
Z_obsDiff_bootmed$yr <- as.numeric(Z_obsDiff_bootmed$yr)
Z_obsDiff_bootmed$V2 <- as.numeric(Z_obsDiff_bootmed$V2)
#Z_expDiff <- unique(alleleFreqVarAvg2[,c(1,6)])
Z_expDiff <- unique(alleleFreqVarAvg2[,c(1,7)])
Z_EO <- left_join(Z_expDiff,Z_obsDiff,by=c("Year"="yr"))
#Z_EO_plot <-
ggplot(Z_EO,aes(x=sum_abs,y=V2)) +
# geom_point() +
theme_bw() +
geom_abline(slope=1,linetype="dashed",color="grey") +
geom_abline(slope=0.5,color="grey") +
geom_text(aes(label=Year))+
xlim(0,0.002) +  ylim(0,0.001)+
labs(title="Z",x=expression(paste("Absolute Predicted Change ",Sigma)),y=expression(paste("Expected Change (", p["t"],"-", p["t-1"], ")"))) + theme(aspect.ratio = 1)
cor(Z_EO$V2, Z_EO$sum)
cor.test(Z_EO$V2, Z_EO$sum)
EO_lm <- lm(V2~ 0+ sum_abs,data=Z_EO)
summary(EO_lm)
##
alleleFreqVarAvg1_Z <- alleleFreqVarAvg2
####combine A and Z####
#stack
AZ_AFVA<-rbind.data.frame(
cbind.data.frame(alleleFreqVarAvg1_A,"chrom"="A"),
cbind.data.frame(alleleFreqVarAvg1_Z,"chrom"="Z")
)
alleleFreqVarAvg1_A
alleleFreqVarAvg1_Z
alleleFreqVarAvg2<-alleleFreqVarAvg[
alleleFreqVarAvg$Category != 'MSMI'
& alleleFreqVarAvg$Category != 'FSFI'
& alleleFreqVarAvg$Category != 'MSFI'
& alleleFreqVarAvg$Category != 'FSMI'
# Remove immigrant covariance and mom-daughter Z inheritance
& alleleFreqVarAvg$Category != 'FIFB'
& alleleFreqVarAvg$Category != 'FSFB',]
# Find sum for each year and calculate proportion for each Category
alleleFreqVarAvg2$sum<-laply(alleleFreqVarAvg2$Year,function(x)   sum(alleleFreqVarAvg2[alleleFreqVarAvg2$Year==x,'avg']))
alleleFreqVarAvg2$prop<-alleleFreqVarAvg2$avg/alleleFreqVarAvg2$sum
alleleFreqVarAvg2$q5_prop <- alleleFreqVarAvg2$q5 / alleleFreqVarAvg2$sum
alleleFreqVarAvg2$q95_prop <- alleleFreqVarAvg2$q95 / alleleFreqVarAvg2$sum
####combine A and Z####
#stack
AZ_AFVA<-rbind.data.frame(
cbind.data.frame(alleleFreqVarAvg1_A,"chrom"="A"),
cbind.data.frame(alleleFreqVarAvg1_Z,"chrom"="Z")
)
alleleFreqVarAvg2<-alleleFreqVarAvg[
alleleFreqVarAvg$Category != 'MSMI'
& alleleFreqVarAvg$Category != 'FSFI'
& alleleFreqVarAvg$Category != 'MSFI'
& alleleFreqVarAvg$Category != 'FSMI'
# Remove immigrant covariance and mom-daughter Z inheritance
& alleleFreqVarAvg$Category != 'FIFB'
& alleleFreqVarAvg$Category != 'FSFB',]
# Find sum for each year and calculate proportion for each Category
alleleFreqVarAvg2$sum<-laply(alleleFreqVarAvg2$Year,function(x)   sum(alleleFreqVarAvg2[alleleFreqVarAvg2$Year==x,'avg']))
#alleleFreqVarAvg2$sum_abs<-laply(alleleFreqVarAvg2$Year,function(x)   sum(abs(alleleFreqVarAvg2[alleleFreqVarAvg2$Year==x,'avg'])))
alleleFreqVarAvg2$prop<-alleleFreqVarAvg2$avg/alleleFreqVarAvg2$sum
alleleFreqVarAvg2$q5_prop <- alleleFreqVarAvg2$q5 / alleleFreqVarAvg2$sum
alleleFreqVarAvg2$q95_prop <- alleleFreqVarAvg2$q95 / alleleFreqVarAvg2$sum
##obs v exp
Z_obsDiff <- laply(c(2000:2013), function(x) {
yr<-as.character(x)
cbind(yr,(sampleVar[sampleVar$Year==x & sampleVar$Category=='xt1-xt','avg']
- simVar[simVar$Year==x & simVar$Category=='errt1-errt',3]
- 2*simVar[simVar$Year==x & simVar$Category=='pt1pterrt1errT',3]))
})
Z_obsDiff <- as.data.frame(Z_obsDiff)
Z_obsDiff$yr <- as.numeric(Z_obsDiff$yr)
Z_obsDiff$V2 <- as.numeric(Z_obsDiff$V2)
Z_obsDiff_bootmed <- laply(c(2000:2013), function(x) {
yr<-as.character(x)
cbind(yr,(allVar_q[allVar_q$Year==x & allVar_q$Category=='xt1-xt','median']
- allVar_q[allVar_q$Year==x & allVar_q$Category=='errt1-errt','median']
- 2*allVar_q[simVar$Year==x & allVar_q$Category=='pt1pterrt1errT','median']))
})
Z_obsDiff_bootmed <- as.data.frame(Z_obsDiff_bootmed)
Z_obsDiff_bootmed$yr <- as.numeric(Z_obsDiff_bootmed$yr)
Z_obsDiff_bootmed$V2 <- as.numeric(Z_obsDiff_bootmed$V2)
#Z_expDiff <- unique(alleleFreqVarAvg2[,c(1,6)])
Z_expDiff <- unique(alleleFreqVarAvg2[,c(1,7)])
Z_EO <- left_join(Z_expDiff,Z_obsDiff,by=c("Year"="yr"))
#Z_EO_plot <-
ggplot(Z_EO,aes(x=sum_abs,y=V2)) +
# geom_point() +
theme_bw() +
geom_abline(slope=1,linetype="dashed",color="grey") +
geom_abline(slope=0.5,color="grey") +
geom_text(aes(label=Year))+
xlim(0,0.002) +  ylim(0,0.001)+
labs(title="Z",x=expression(paste("Absolute Predicted Change ",Sigma)),y=expression(paste("Expected Change (", p["t"],"-", p["t-1"], ")"))) + theme(aspect.ratio = 1)
cor(Z_EO$V2, Z_EO$sum)
cor.test(Z_EO$V2, Z_EO$sum)
EO_lm <- lm(V2~ 0+ sum_abs,data=Z_EO)
summary(EO_lm)
##
alleleFreqVarAvg1_Z <- alleleFreqVarAvg2
####combine A and Z####
#stack
AZ_AFVA<-rbind.data.frame(
cbind.data.frame(alleleFreqVarAvg1_A,"chrom"="A"),
cbind.data.frame(alleleFreqVarAvg1_Z,"chrom"="Z")
)
#merge
alleleFreqVarAvg1_AZ <- left_join(alleleFreqVarAvg1_A,alleleFreqVarAvg1_Z,by=c("Year"="Year","Category"="Category"))
####categories and sexes####
detach(package:plyr)
#set sex label & factor
AZ_AFVA$SexCat[AZ_AFVA$Category %in% c("FSsq","FIsq","FBsq","FIFB","FSFB")] <- "Female"
AZ_AFVA$SexCat[AZ_AFVA$Category %in% c("MSsq","MIsq","MBsq","MIMB","MSMB")] <- "Male"
AZ_AFVA$SexCat[AZ_AFVA$Category %in% c("FIMB","FSMB","MIFB","MSFB","MBFB","MSFS","MIFI")] <- "Cov(F,M)"
AZ_AFVA$sexCat <- factor(AZ_AFVA$SexCat,levels=c("Female" ,"Male"    ,   "Cov(F,M)"))
AZ_AFVA_sex <-
AZ_AFVA %>% group_by(chrom,Year) %>%
mutate(sex_sum=sum(avg)) %>%
group_by(chrom,Year,SexCat) %>%
mutate(sexCat_sum=sum(avg)/sex_sum)
AZ_AFVA_sex_only <- unique(AZ_AFVA_sex[,c(1,10,12:14)])
AZ_AFVA_sex_only$SexCat = factor(AZ_AFVA_sex_only$sexCat, levels=c('Cov(F,M)','Female','Male'))
#set factor order
AZ_AFVA$faccat <- factor(AZ_AFVA$Category,
levels =
c("MSsq", "MIsq","MBsq",
"MSMB" , "MIMB"  ,"FBsq",
"FSsq"  , "FIsq",
"FSFB"   , "FIFB"    ,
"MSFS"   ,   "MBFB"  ,     "MIFI"   ,
"MSFB"    ,   "MIFB"   ,   "FSMB"   ,   "FIMB"
))
#set demographic group label & factor
AZ_AFVA$Supercategory<-factor(ifelse(AZ_AFVA$Category=='MIFI' | AZ_AFVA$Category=='MIsq' |  AZ_AFVA$Category=='FIsq','Immigrant',
ifelse(AZ_AFVA$Category=='MIMB' | AZ_AFVA$Category=='FIFB' | AZ_AFVA$Category=='MIFB' |  AZ_AFVA$Category=='FIMB', 'Cov(I,B)',
ifelse( AZ_AFVA$Category=='MBFB' | AZ_AFVA$Category=='MBsq' | AZ_AFVA$Category=='FBsq', 'Birth',
ifelse(AZ_AFVA$Category=='MSMB' | AZ_AFVA$Category=='FSFB' | AZ_AFVA$Category=='MSFB' | AZ_AFVA$Category=='FSMB', 'Cov(S,B)',
ifelse(AZ_AFVA$Category=='MSsq' |AZ_AFVA$Category=='FSsq' | AZ_AFVA$Category=='MSFS', 'Survivor', NA))))),
levels = c('Immigrant', 'Cov(I,B)', 'Birth','Cov(S,B)','Survivor'))
AZ_AFVA$supercategory <- factor(AZ_AFVA$Supercategory,levels=c("Survivor","Cov(S,B)","Birth","Cov(I,B)","Immigrant"))
AZ_AFVA$Category2 <- AZ_AFVA$Category
AZ_AFVA$Category2[AZ_AFVA$Category %in% c("FSsq","MSsq","MSFS")] <- "S"
AZ_AFVA$Category2[AZ_AFVA$Category %in% c("FIsq","MIsq","MIFI")] <- "I"
AZ_AFVA$Category2[AZ_AFVA$Category %in% c("FBsq","MBsq","MBFB")] <- "B"
AZ_AFVA$Category2[AZ_AFVA$Category %in% c("MIMB","FIFB")] <- "IB"
AZ_AFVA$Category2[AZ_AFVA$Category %in% c("MSMB","FSFB")] <- "SB"
#set sex covariances
AZ_AFVA$Category4 <- NA
AZ_AFVA$Category4[AZ_AFVA$Category %in% c("FIMB","FSMB")] <- "FM"
AZ_AFVA$Category4[AZ_AFVA$Category %in% c("MIFB","MSFB")] <- "MF"
AZ_AFVA_cat <-
AZ_AFVA %>% group_by(chrom,Year) %>%
mutate(cat_sum=sum(avg)) %>%
group_by(chrom,Year,supercategory) %>%
mutate(catCat_sum=sum(avg)/cat_sum)
AZ_AFVA_cat_only <- unique(AZ_AFVA_cat[,c(1,10,15,18:19)])
AZ_AFVA_cat_only$supercategory = factor(AZ_AFVA_cat_only$supercategory, levels=c('Cov(I,B)','Immigrant','Cov(S,B)','Birth','Survivor'))
fills_to_use_cat <-c(pnw_palettes$Bay[1,1],pnw_palettes$Bay[1,2],pnw_palettes$Bay[1,5], pnw_palettes$Bay[1,3],pnw_palettes$Bay[1,4])
####plot fig. 4B####
varp_title <- expression(atop("Proportional Contribution",paste("to ",Delta, "p variance")))
sex_stack_plot <-
ggplot() +
geom_hline(yintercept = 0,alpha=0.5)+
geom_hline(yintercept = 1,alpha=0.5)+
geom_bar(data=AZ_AFVA_sex_only, aes(x=Year, y=sexCat_sum,fill=SexCat,group=SexCat), stat='identity',alpha=0.75) +
facet_grid(chrom~.,scales="free",space="free") +
labs(y=varp_title,x="Year") +
theme_bw(base_size = 8) +
theme(strip.background =element_rect(fill="white")) +
scale_fill_manual("Category",values=c("mediumpurple","indianred1","cornflowerblue")) +
guides(color=FALSE)  +
theme( panel.grid.minor = element_blank(), panel.grid.major = element_blank()) +
scale_y_continuous(breaks=c(0,0.5,1))
min(AZ_AFVA_sex_only$sexCat_sum[AZ_AFVA_sex_only$sexCat == "Male" & AZ_AFVA_sex_only$chrom == "A"])
max(AZ_AFVA_sex_only$sexCat_sum[AZ_AFVA_sex_only$sexCat == "Male" & AZ_AFVA_sex_only$chrom == "A"])
min(AZ_AFVA_sex_only$sexCat_sum[AZ_AFVA_sex_only$sexCat == "Female" & AZ_AFVA_sex_only$chrom == "A"])
max(AZ_AFVA_sex_only$sexCat_sum[AZ_AFVA_sex_only$sexCat == "Female" & AZ_AFVA_sex_only$chrom == "A"])
min(AZ_AFVA_sex_only$sexCat_sum[AZ_AFVA_sex_only$sexCat == "Male" & AZ_AFVA_sex_only$chrom == "Z"])
max(AZ_AFVA_sex_only$sexCat_sum[AZ_AFVA_sex_only$sexCat == "Male" & AZ_AFVA_sex_only$chrom == "Z"])
min(AZ_AFVA_sex_only$sexCat_sum[AZ_AFVA_sex_only$sexCat == "Female" & AZ_AFVA_sex_only$chrom == "Z"])
max(AZ_AFVA_sex_only$sexCat_sum[AZ_AFVA_sex_only$sexCat == "Female" & AZ_AFVA_sex_only$chrom == "Z"])
cat_stack_plot <-
ggplot() +
geom_hline(yintercept = 0,alpha=0.5)+
geom_hline(yintercept = 1,alpha=0.5)+
geom_bar(data=AZ_AFVA_cat_only, aes(x=Year, y=catCat_sum,fill=supercategory,group=supercategory), stat='identity',alpha=0.75) +
facet_grid(chrom~.,scales="free",space="free") +
labs(y=varp_title,x="Year") +
theme_bw(base_size = 8) +
theme(strip.background =element_rect(fill="white")) +
scale_fill_manual("Category",values=fills_to_use_cat) +
guides(color=FALSE)  +
theme( panel.grid.minor = element_blank(), panel.grid.major = element_blank()) +
scale_y_continuous(breaks=c(0,0.5,1))
rep_sum_A <- AZ_AFVA_cat_only[AZ_AFVA_cat_only$supercategory %in% c("Survivor","Birth","Cov(S,B)") & AZ_AFVA_cat_only$chrom == "A",] %>%
group_by(chrom,Year) %>%
summarize(rep_sum=sum( catCat_sum))
rep_sum_Z <- AZ_AFVA_cat_only[AZ_AFVA_cat_only$supercategory %in% c("Survivor","Birth","Cov(S,B)") & AZ_AFVA_cat_only$chrom == "Z",] %>%
group_by(chrom,Year) %>%
summarize(rep_sum=sum( catCat_sum))
#quartz(width=6, height=4,dpi=300)
pdf(paste("fig_4BC.pdf",sep=''),width=4.5,height=3)
plot_grid(sex_stack_plot,  cat_stack_plot,  labels = c('B', 'C'), ncol = 1, align = 'v',axis='rl')
dev.off()
plot_grid(sex_stack_plot,  cat_stack_plot,  labels = c('B', 'C'), ncol = 1, align = 'v',axis='rl')
#plotting parameters
Avarp_title <- expression(paste("Autosomal Variance ",Delta, "p"))
Zvarp_title <- expression(paste("Z Variance ",Delta, "p"))
fills_to_use <-c(pnw_palettes$Bay[1,3],pnw_palettes$Winter[1,2],"#DD4124", pnw_palettes$Bay[1,2],pnw_palettes$Bay[1,1],pnw_palettes$Winter[1,4],"#E77A66",pnw_palettes$Bay[1,4],pnw_palettes$Bay[1,5])
####Plot Fig. 5####
AZ_AFVA$year_adj <- AZ_AFVA$Year
AZ_AFVA$year_adj[AZ_AFVA$chrom == "A"] <- AZ_AFVA$year_adj[AZ_AFVA$chrom == "A"] + 0.25
varp_title2 <- expression(paste("Proportional Contribution to ",Delta, "p variance"))
ggplot(data=AZ_AFVA, aes(x=year_adj, y=prop)) +
geom_hline(yintercept = 0,alpha=0.5,size=0.25)+
#  geom_errorbar(aes(ymin=q5_prop, ymax=q95_prop,color=Category2,linetype=chrom), width=.1,alpha=0.5,size=0.15) +
#  geom_line(aes(linetype=chrom,color=Category2),alpha=0.5) +
geom_point(aes(color=Category2,shape=chrom),size=0.75) +
guides(color=FALSE) +
facet_grid(  supercategory ~sexCat,scales="free")+
theme_bw(base_size = 8) +
scale_x_continuous(breaks=c(2000,2005,2010),limits = c(1999,2015))+
scale_color_manual(values=fills_to_use)+
scale_shape_manual(values=c(16,1)) +
# scale_linetype_manual(values=c("solid","dashed")) +
labs(y=varp_title2,x="Year",color="Category",linetype="") +
theme(strip.background =element_rect(fill="white")) +
geom_dl(aes(label = Category4,color=Category2), method = list("last.qp",cex = 0.5,dl.trans(x = x + .2))) +
theme( panel.grid.minor = element_blank(),panel.grid.major = element_blank()) +
coord_cartesian(ylim = c(-0.25, 0.5))
ggplot(data=AZ_AFVA, aes(x=year_adj, y=prop)) +
geom_hline(yintercept = 0,alpha=0.5,size=0.25)+
geom_errorbar(aes(ymin=q5_prop, ymax=q95_prop,color=Category2,linetype=chrom), width=.1,alpha=0.5,size=0.15) +
#  geom_line(aes(linetype=chrom,color=Category2),alpha=0.5) +
geom_point(aes(color=Category2,shape=chrom),size=0.75) +
guides(color=FALSE) +
facet_grid(  supercategory ~sexCat,scales="free")+
theme_bw(base_size = 8) +
scale_x_continuous(breaks=c(2000,2005,2010),limits = c(1999,2015))+
scale_color_manual(values=fills_to_use)+
scale_shape_manual(values=c(16,1)) +
# scale_linetype_manual(values=c("solid","dashed")) +
labs(y=varp_title2,x="Year",color="Category",linetype="") +
theme(strip.background =element_rect(fill="white")) +
geom_dl(aes(label = Category4,color=Category2), method = list("last.qp",cex = 0.5,dl.trans(x = x + .2))) +
theme( panel.grid.minor = element_blank(),panel.grid.major = element_blank()) +
coord_cartesian(ylim = c(-0.25, 0.5))
