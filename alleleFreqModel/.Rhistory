ASNPS <- map[map$V1 %ni% c(39,41) ,]
ASNPS$map_pos <- seq(1,length(ASNPS$V1))
ASNPS$SNP_name <- names(indivlistgeno_A[,-c(1:8)])
chip <- read.table('working_files/chrom.map',fill=TRUE,header=TRUE)
ASNPS_chip <- left_join(chip,AframeworkMap,by=c("SNPname"="V3"))
#w_size = 3400000
w_size = 5 #cM
win_global = 0
for(lg in na.omit(unique(ASNPS_chip$V1))){
#size_tmp <- sizes$V2[sizes$V1 == lg]
winSeq <- seq(from=0,to=max(ASNPS_chip$V4[ASNPS_chip$V1 == lg],na.rm=T),by = w_size)
for(win in winSeq){
if(win+w_size<=max(winSeq)){
cat(lg, ((win/w_size) + win_global)," ",win," ",Z_size,"\n")
ASNPS_chip$bootstrap[ASNPS_chip$V4 > win & ASNPS_chip$V4 <= (win+w_size) & ASNPS_chip$V1 == lg ] <-
(win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",max(winSeq)," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
win_global = 0
for(lg in na.omit(unique(ASNPS_chip$V1))){
#size_tmp <- sizes$V2[sizes$V1 == lg]
winSeq <- seq(from=0,to=max(ASNPS_chip$V4[ASNPS_chip$V1 == lg],na.rm=T),by = w_size)
for(win in winSeq){
if(win+w_size<=max(winSeq)){
cat(lg, ((win/w_size) + win_global)," ",win," ",max(winSeq),"\n")
ASNPS_chip$bootstrap[ASNPS_chip$V4 > win & ASNPS_chip$V4 <= (win+w_size) & ASNPS_chip$V1 == lg ] <-
(win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",max(winSeq)," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
ASNPS_ordered <- ASNPS_chip[order(ASNPS_chip$NewScaff,ASNPS_chip$SNPpos),]
ASNPS_ordered <- ASNPS_ordered %>% filter(newSNPname != "" & NewScaff %in%  c(
"ScYP8k313HRSCAF58ch1"   , "ScYP8k312HRSCAF54ch1A"   , "ScYP8k3629HRSCAF770ch2" ,  "ScYP8k3866HRSCAF1020ch3" , "ScYP8k311HRSCAF50ch4","ScYP8k314HRSCAF84ch4A"  ,
"ScYP8k39HRSCAF32ch6" , "ScYP8k35HRSCAF18ch5"     , "ScYP8k34HRSCAF13ch7"   , "ScYP8k31HRSCAF1ch8"   ,  "ScYP8k33HRSCAF8ch9" , "ScYP8k32HRSCAF3ch10"   ,
"ScYP8k3869HRSCAF1023ch11",  "ScYP8k3870HRSCAF1029ch12",  "ScYP8k3302HRSCAF431ch13"  , "ScYP8k3651HRSCAF793ch14" ,  "ScYP8k3864HRSCAF1010ch15",
"ScYP8k37HRSCAF29ch17"   , "ScYP8k38HRSCAF31ch18"  ,  "ScYP8k36HRSCAF25ch19" ,"ScYP8k3865HRSCAF1011ch20",   "ScYP8k369HRSCAF175ch21" ,   "ScYP8k369HRSCAF175ch22"  ,
"ScYP8k369HRSCAF175ch23",  "ScYP8k369HRSCAF175ch24" , "ScYP8k369HRSCAF175ch25" ,"ScYP8k369HRSCAF175ch26", "ScYP8k369HRSCAF175ch27"  , "ScYP8k369HRSCAF175ch28"))
bootstrap = 0
for(scaff in unique(ASNPS_ordered$NewScaff)){
bootstrap = min(ASNPS_ordered$bootstrap[ASNPS_ordered$NewScaff == scaff])
for(snp in ASNPS_ordered$SNPname){
if(ASNPS_ordered$NewScaff[ASNPS_ordered$SNPname == snp ] == scaff){
if( !is.na(ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff])){
bootstrap <- ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff]
}
if( is.na(ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff])){
ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff] <- bootstrap
}
}
}
}
A_bootstrap_map <- ASNPS_ordered %>% dplyr::select(SNPname,V1,NewScaff,V4,SNPpos,bootstrap)
names(A_bootstrap_map) <- c("SNP","linkage_group","scaff","cM","bp","bootstrap_cm")
sizes <- read.table('working_files/FSJ.chrom.sizes')
A_bootstrap_ordered <- A_bootstrap_map[order(A_bootstrap_map$scaff,A_bootstrap_map$bp),]
w_size = 3400000
win_global = 0
for(scaf in unique(A_bootstrap_ordered$scaff)){
size_tmp <- sizes$V2[sizes$V1 == scaf]
for(win in seq(from=0,to=max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf],na.rm=T),by = w_size)){
if(win+w_size<size_tmp){
cat(scaf, ((win/w_size) + win_global)," ",win," ",size_tmp,"\n")
A_bootstrap_ordered$bootstrap_bp[A_bootstrap_ordered$bp > win & A_bootstrap_ordered$bp <= (win+w_size) & A_bootstrap_ordered$scaff == scaf] <- (win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",size_tmp," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
A_bootstrap_cmtally <- A_bootstrap_ordered %>% group_by(bootstrap_cm) %>% tally()
A_bootstrap_bptally <- A_bootstrap_ordered %>% group_by(bootstrap_bp) %>% tally()
View(A_bootstrap_bptally)
View(A_bootstrap_cmtally)
A_bootstrap_cmtally <- A_bootstrap_ordered %>% group_by(bootstrap_cm) %>% tally() %>% filter(n >= 5)
A_bootstrap_bptally <- A_bootstrap_ordered %>% group_by(bootstrap_bp) %>% tally() %>% filter(n >= 5)
View(A_bootstrap_bptally)
View(A_bootstrap_cmtally)
badBoots_cm <- A_bootstrap_ordered %>% group_by(bootstrap_cm) %>% tally() %>% filter(n < 5)
badBoots_mb <- A_bootstrap_ordered %>% group_by(bootstrap_bp) %>% tally() %>% filter(n < 5)
badBoots_cm
badBoots_cm <- A_bootstrap_ordered %>% group_by(bootstrap_cm) %>% tally() %>% filter(n < 5)
badBoots_cm
badBoots_mb <- A_bootstrap_ordered %>% group_by(bootstrap_bp) %>% tally() %>% filter(n < 5)
badBoots_mb
View(A_bootstrap_ordered)
badBoots_mb <- A_bootstrap_ordered %>% group_by(bootstrap_bp) %>% tally() #%>% filter(n < 5)
View(badBoots_mb)
badBoots_mb <- A_bootstrap_ordered %>% group_by(bootstrap_bp) %>% tally() %>% filter(n < 5)
A_bootstrap_ordered$bootstrap_cm[A_bootstrap_ordered$bootstrap_cm %in% badBoots_cm$bootstrap_cm] <- NA
A_bootstrap_ordered$badBoots_mb[A_bootstrap_ordered$badBoots_mb %in% badBoots_mb$badBoots_mb] <- NA
A_bootstrap_ordered$bootstrap_mb[A_bootstrap_ordered$bootstrap_mb %in% badBoots_mb$badBoots_mb] <- NA
A_bootstrap_ordered$bootstrap_mb[A_bootstrap_ordered$bootstrap_mb %in% badBoots_mb$bootstrap_mb] <- NA
badBoots_mb
A_bootstrap_ordered <- A_bootstrap_map[order(A_bootstrap_map$scaff,A_bootstrap_map$bp),]
w_size = 3400000
win_global = 0
for(scaf in unique(A_bootstrap_ordered$scaff)){
size_tmp <- sizes$V2[sizes$V1 == scaf]
for(win in seq(from=0,to=max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf],na.rm=T),by = w_size)){
if(win+w_size<size_tmp){
cat(scaf, ((win/w_size) + win_global)," ",win," ",size_tmp,"\n")
A_bootstrap_ordered$bootstrap_bp[A_bootstrap_ordered$bp > win & A_bootstrap_ordered$bp <= (win+w_size) & A_bootstrap_ordered$scaff == scaf] <- (win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",size_tmp," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
badBoots_cm <- A_bootstrap_ordered %>% group_by(bootstrap_cm) %>% tally() %>% filter(n < 5)
badBoots_mb <- A_bootstrap_ordered %>% group_by(bootstrap_bp) %>% tally() %>% filter(n < 5)
A_bootstrap_ordered$bootstrap_cm[A_bootstrap_ordered$bootstrap_cm %in% badBoots_cm$bootstrap_cm] <- NA
badBoots_mb
write.table(A_bootstrap_ordered, file = paste("bootstrapMap.A.txt",sep=""),
append = F, quote = FALSE, sep = "\t",
eol = "\n", na = "NA", dec = ".", row.names = FALSE,
col.names = TRUE, qmethod = c("escape", "double"))
frameworkSNPs <- read.table('frameworkSNPs.list')
frameworkSNPs$SNP <- paste(frameworkSNPs$V1,frameworkSNPs$V2,sep="_")
fullMap <- read.table('all.fixed.txt',fill = T)
fullMap$SNP <- paste(fullMap$V1,fullMap$V2,sep="_")
AframeworkMap <- fullMap %>% filter(V1 %in% c(39) & SNP %in% frameworkSNPs$SNP)
AframeworkMap
map<-read.table('working_files/geno.map',header=TRUE)
ASNPS <- map[map$V1 %in% c(39) ,]
ASNPS$map_pos <- seq(1,length(ASNPS$V1))
ASNPS$SNP_name <- names(indivlistgeno_A[,-c(1:8)])
load(file='working_files/intermediate_files/indivlistgeno_Z.rdata')
ASNPS$SNP_name <- names(indivlistgeno_Z[,-c(1:8)])
chip <- read.table('working_files/chrom.map',fill=TRUE,header=TRUE)
ASNPS_chip <- left_join(chip,AframeworkMap,by=c("SNPname"="V3"))
#w_size = 3400000
w_size = 5 #cM
win_global = 0
unique(ASNPS_chip$V1)
for(lg in na.omit(unique(ASNPS_chip$V1))){
#size_tmp <- sizes$V2[sizes$V1 == lg]
winSeq <- seq(from=0,to=max(ASNPS_chip$V4[ASNPS_chip$V1 == lg],na.rm=T),by = w_size)
for(win in winSeq){
if(win+w_size<=max(winSeq)){
cat(lg, ((win/w_size) + win_global)," ",win," ",max(winSeq),"\n")
ASNPS_chip$bootstrap[ASNPS_chip$V4 > win & ASNPS_chip$V4 <= (win+w_size) & ASNPS_chip$V1 == lg ] <-
(win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",max(winSeq)," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
ASNPS_ordered <- ASNPS_chip[order(ASNPS_chip$NewScaff,ASNPS_chip$SNPpos),]
ASNPS_ordered
ASNPS_ordered <- ASNPS_ordered %>% filter(newSNPname != "" & NewScaff %in%  c( "ScYP8k310HRSCAF43chZ"))
bootstrap = 0
for(scaff in unique(ASNPS_ordered$NewScaff)){
bootstrap = min(ASNPS_ordered$bootstrap[ASNPS_ordered$NewScaff == scaff])
for(snp in ASNPS_ordered$SNPname){
if(ASNPS_ordered$NewScaff[ASNPS_ordered$SNPname == snp ] == scaff){
if( !is.na(ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff])){
bootstrap <- ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff]
}
if( is.na(ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff])){
ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff] <- bootstrap
}
}
}
}
A_bootstrap_map <- ASNPS_ordered %>% dplyr::select(SNPname,V1,NewScaff,V4,SNPpos,bootstrap)
names(A_bootstrap_map) <- c("SNP","linkage_group","scaff","cM","bp","bootstrap_cm")
A_bootstrap_map
sizes <- read.table('working_files/FSJ.chrom.sizes')
A_bootstrap_ordered <- A_bootstrap_map[order(A_bootstrap_map$scaff,A_bootstrap_map$bp),]
w_size = 3400000
win_global = 0
for(scaf in unique(A_bootstrap_ordered$scaff)){
size_tmp <- sizes$V2[sizes$V1 == scaf]
for(win in seq(from=0,to=max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf],na.rm=T),by = w_size)){
if(win+w_size<size_tmp){
cat(scaf, ((win/w_size) + win_global)," ",win," ",size_tmp,"\n")
A_bootstrap_ordered$bootstrap_bp[A_bootstrap_ordered$bp > win & A_bootstrap_ordered$bp <= (win+w_size) & A_bootstrap_ordered$scaff == scaf] <- (win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",size_tmp," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
sizes
A_bootstrap_ordered <- A_bootstrap_map[order(A_bootstrap_map$scaff,A_bootstrap_map$bp),]
w_size = 3400000
win_global = 0
for(scaf in unique(A_bootstrap_ordered$scaff)){
size_tmp <- sizes$V2[sizes$V1 == scaf]
for(win in seq(from=0,to=max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf],na.rm=T),by = w_size)){
if(win+w_size<size_tmp){
cat(scaf, ((win/w_size) + win_global)," ",win," ",size_tmp,"\n")
A_bootstrap_ordered$bootstrap_bp[A_bootstrap_ordered$bp > win & A_bootstrap_ordered$bp <= (win+w_size) & A_bootstrap_ordered$scaff == scaf] <- (win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",size_tmp," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
size_tmp
max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf]
max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf])
max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf])
View(A_bootstrap_ordered)
A_bootstrap_ordered$bp <- as.numeric(A_bootstrap_ordered$bp )
A_bootstrap_map$bp <- as.numeric(A_bootstrap_map$bp )
A_bootstrap_ordered <- A_bootstrap_map[order(A_bootstrap_map$scaff,A_bootstrap_map$bp),]
w_size = 3400000
win_global = 0
max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf])
seq(from=0,to=max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf]),na.rm=T),by = w_size)
win_global = 0
for(scaf in unique(A_bootstrap_ordered$scaff)){
w_size = 3400000
win_global = 0
for(scaf in unique(A_bootstrap_ordered$scaff)){
size_tmp <- sizes$V2[sizes$V1 == scaf]
for(win in seq(from=0,to=max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf],na.rm=T),by = w_size)){
if(win+w_size<size_tmp){
cat(scaf, ((win/w_size) + win_global)," ",win," ",size_tmp,"\n")
A_bootstrap_ordered$bootstrap_bp[A_bootstrap_ordered$bp > win & A_bootstrap_ordered$bp <= (win+w_size) & A_bootstrap_ordered$scaff == scaf] <- (win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",size_tmp," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
badBoots_cm <- A_bootstrap_ordered %>% group_by(bootstrap_cm) %>% tally() %>% filter(n < 5)
badBoots_mb <- A_bootstrap_ordered %>% group_by(bootstrap_bp) %>% tally() %>% filter(n < 5)
badBoots_mb
badBoots_cm
A_bootstrap_map <- ASNPS_ordered %>% dplyr::select(SNPname,V1,NewScaff,V4,SNPpos,bootstrap)
names(A_bootstrap_map) <- c("SNP","linkage_group","scaff","cM","bp","bootstrap_cm")
sizes <- read.table('working_files/FSJ.chrom.sizes')
A_bootstrap_map$bp <- as.numeric(A_bootstrap_map$bp )
A_bootstrap_ordered <- A_bootstrap_map[order(A_bootstrap_map$scaff,A_bootstrap_map$bp),]
w_size = 3400000
win_global = 0
for(scaf in unique(A_bootstrap_ordered$scaff)){
size_tmp <- sizes$V2[sizes$V1 == scaf]
for(win in seq(from=0,to=max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf],na.rm=T),by = w_size)){
if(win+w_size<size_tmp){
cat(scaf, ((win/w_size) + win_global)," ",win," ",size_tmp,"\n")
A_bootstrap_ordered$bootstrap_bp[A_bootstrap_ordered$bp > win & A_bootstrap_ordered$bp <= (win+w_size) & A_bootstrap_ordered$scaff == scaf] <- (win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",size_tmp," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
badBoots_cm <- A_bootstrap_ordered %>% group_by(bootstrap_cm) %>% tally() %>% filter(n < 5)
badBoots_bp <- A_bootstrap_ordered %>% group_by(bootstrap_bp) %>% tally() %>% filter(n < 5)
badBoots_cm
badBoots_cm
badBoots_bp
A_bootstrap_ordered %>% group_by(bootstrap_bp) %>% tally()
A_bootstrap_ordered$bootstrap_cm[A_bootstrap_ordered$bootstrap_cm %in% badBoots_cm$bootstrap_cm] <- NA
write.table(A_bootstrap_ordered, file = paste("bootstrapMap.Z.txt",sep=""),
append = F, quote = FALSE, sep = "\t",
eol = "\n", na = "NA", dec = ".", row.names = FALSE,
col.names = TRUE, qmethod = c("escape", "double"))
ASNPS_ordered <- ASNPS_chip %>% filter(newSNPname != "" & NewScaff %in%  c( "ScYP8k310HRSCAF43chZ"))
ASNPS_ordered
ASNPS_ordered$SNPpos <- as.numeric(ASNPS_ordered$SNPpos )
ASNPS_ordered <- ASNPS_ordered[order(ASNPS_ordered$NewScaff,ASNPS_ordered$SNPpos),]
bootstrap = 0
for(scaff in unique(ASNPS_ordered$NewScaff)){
bootstrap = min(ASNPS_ordered$bootstrap[ASNPS_ordered$NewScaff == scaff])
for(snp in ASNPS_ordered$SNPname){
if(ASNPS_ordered$NewScaff[ASNPS_ordered$SNPname == snp ] == scaff){
if( !is.na(ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff])){
bootstrap <- ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff]
}
if( is.na(ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff])){
ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff] <- bootstrap
}
}
}
}
A_bootstrap_map <- ASNPS_ordered %>% dplyr::select(SNPname,V1,NewScaff,V4,SNPpos,bootstrap)
names(A_bootstrap_map) <- c("SNP","linkage_group","scaff","cM","bp","bootstrap_cm")
View(A_bootstrap_map)
sizes <- read.table('working_files/FSJ.chrom.sizes')
A_bootstrap_ordered <- A_bootstrap_map[order(A_bootstrap_map$scaff,A_bootstrap_map$bp),]
w_size = 3400000
win_global = 0
for(scaf in unique(A_bootstrap_ordered$scaff)){
size_tmp <- sizes$V2[sizes$V1 == scaf]
for(win in seq(from=0,to=max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf],na.rm=T),by = w_size)){
if(win+w_size<size_tmp){
cat(scaf, ((win/w_size) + win_global)," ",win," ",size_tmp,"\n")
A_bootstrap_ordered$bootstrap_bp[A_bootstrap_ordered$bp > win & A_bootstrap_ordered$bp <= (win+w_size) & A_bootstrap_ordered$scaff == scaf] <- (win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",size_tmp," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
badBoots_cm <- A_bootstrap_ordered %>% group_by(bootstrap_cm) %>% tally() %>% filter(n < 5)
badBoots_bp <- A_bootstrap_ordered %>% group_by(bootstrap_bp) %>% tally() %>% filter(n < 5)
A_bootstrap_ordered$bootstrap_cm[A_bootstrap_ordered$bootstrap_cm %in% badBoots_cm$bootstrap_cm] <- NA
View(A_bootstrap_ordered)
write.table(A_bootstrap_ordered, file = paste("bootstrapMap.Z.txt",sep=""),
append = F, quote = FALSE, sep = "\t",
eol = "\n", na = "NA", dec = ".", row.names = FALSE,
col.names = TRUE, qmethod = c("escape", "double"))
load(file='working_files/intermediate_files/indivlistgeno_A.rdata')
frameworkSNPs <- read.table('frameworkSNPs.list')
frameworkSNPs$SNP <- paste(frameworkSNPs$V1,frameworkSNPs$V2,sep="_")
fullMap <- read.table('all.fixed.txt',fill = T)
fullMap$SNP <- paste(fullMap$V1,fullMap$V2,sep="_")
AframeworkMap <- fullMap %>% filter(V1 %ni% c(39,41) & SNP %in% frameworkSNPs$SNP)
map<-read.table('working_files/geno.map',header=TRUE)
ASNPS <- map[map$V1 %ni% c(39,41) ,]
ASNPS$map_pos <- seq(1,length(ASNPS$V1))
ASNPS$SNP_name <- names(indivlistgeno_Z[,-c(1:8)])
chip <- read.table('working_files/chrom.map',fill=TRUE,header=TRUE)
ASNPS$SNP_name <- names(indivlistgeno_A[,-c(1:8)])
load(file='working_files/intermediate_files/indivlistgeno_A.rdata')
frameworkSNPs <- read.table('frameworkSNPs.list')
frameworkSNPs$SNP <- paste(frameworkSNPs$V1,frameworkSNPs$V2,sep="_")
fullMap <- read.table('all.fixed.txt',fill = T)
fullMap$SNP <- paste(fullMap$V1,fullMap$V2,sep="_")
AframeworkMap <- fullMap %>% filter(V1 %ni% c(39,41) & SNP %in% frameworkSNPs$SNP)
map<-read.table('working_files/geno.map',header=TRUE)
ASNPS <- map[map$V1 %ni% c(39,41) ,]
ASNPS$map_pos <- seq(1,length(ASNPS$V1))
ASNPS$SNP_name <- names(indivlistgeno_A[,-c(1:8)])
chip <- read.table('working_files/chrom.map',fill=TRUE,header=TRUE)
ASNPS_chip <- left_join(chip,AframeworkMap,by=c("SNPname"="V3"))
#w_size = 3400000
w_size = 5 #cM
win_global = 0
for(lg in na.omit(unique(ASNPS_chip$V1))){
#size_tmp <- sizes$V2[sizes$V1 == lg]
winSeq <- seq(from=0,to=max(ASNPS_chip$V4[ASNPS_chip$V1 == lg],na.rm=T),by = w_size)
for(win in winSeq){
if(win+w_size<=max(winSeq)){
cat(lg, ((win/w_size) + win_global)," ",win," ",max(winSeq),"\n")
ASNPS_chip$bootstrap[ASNPS_chip$V4 > win & ASNPS_chip$V4 <= (win+w_size) & ASNPS_chip$V1 == lg ] <-
(win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",max(winSeq)," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
ASNPS_ordered <- ASNPS_chip %>% filter(newSNPname != "" & NewScaff %in%  c( "ScYP8k310HRSCAF43chZ"))
ASNPS_ordered$SNPpos <- as.numeric(ASNPS_ordered$SNPpos )
ASNPS_ordered <- ASNPS_ordered[order(ASNPS_ordered$NewScaff,ASNPS_ordered$SNPpos),]
bootstrap = 0
for(scaff in unique(ASNPS_ordered$NewScaff)){
bootstrap = min(ASNPS_ordered$bootstrap[ASNPS_ordered$NewScaff == scaff])
for(snp in ASNPS_ordered$SNPname){
if(ASNPS_ordered$NewScaff[ASNPS_ordered$SNPname == snp ] == scaff){
if( !is.na(ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff])){
bootstrap <- ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff]
}
if( is.na(ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff])){
ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff] <- bootstrap
}
}
}
}
A_bootstrap_map <- ASNPS_ordered %>% dplyr::select(SNPname,V1,NewScaff,V4,SNPpos,bootstrap)
names(A_bootstrap_map) <- c("SNP","linkage_group","scaff","cM","bp","bootstrap_cm")
sizes <- read.table('working_files/FSJ.chrom.sizes')
A_bootstrap_ordered <- A_bootstrap_map[order(A_bootstrap_map$scaff,A_bootstrap_map$bp),]
w_size = 3400000
win_global = 0
for(scaf in unique(A_bootstrap_ordered$scaff)){
size_tmp <- sizes$V2[sizes$V1 == scaf]
for(win in seq(from=0,to=max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf],na.rm=T),by = w_size)){
if(win+w_size<size_tmp){
#cat(scaf, ((win/w_size) + win_global)," ",win," ",size_tmp,"\n")
A_bootstrap_ordered$bootstrap_bp[A_bootstrap_ordered$bp > win & A_bootstrap_ordered$bp <= (win+w_size) & A_bootstrap_ordered$scaff == scaf] <- (win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",size_tmp," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
View(A_bootstrap_ordered)
load(file='working_files/intermediate_files/indivlistgeno_A.rdata')
frameworkSNPs <- read.table('frameworkSNPs.list')
frameworkSNPs$SNP <- paste(frameworkSNPs$V1,frameworkSNPs$V2,sep="_")
fullMap <- read.table('all.fixed.txt',fill = T)
fullMap$SNP <- paste(fullMap$V1,fullMap$V2,sep="_")
AframeworkMap <- fullMap %>% filter(V1 %ni% c(39,41) & SNP %in% frameworkSNPs$SNP)
map<-read.table('working_files/geno.map',header=TRUE)
ASNPS <- map[map$V1 %ni% c(39,41) ,]
ASNPS$map_pos <- seq(1,length(ASNPS$V1))
ASNPS$SNP_name <- names(indivlistgeno_A[,-c(1:8)])
chip <- read.table('working_files/chrom.map',fill=TRUE,header=TRUE)
ASNPS_chip <- left_join(chip,AframeworkMap,by=c("SNPname"="V3"))
#w_size = 3400000
w_size = 5 #cM
win_global = 0
for(lg in na.omit(unique(ASNPS_chip$V1))){
#size_tmp <- sizes$V2[sizes$V1 == lg]
winSeq <- seq(from=0,to=max(ASNPS_chip$V4[ASNPS_chip$V1 == lg],na.rm=T),by = w_size)
for(win in winSeq){
if(win+w_size<=max(winSeq)){
#cat(lg, ((win/w_size) + win_global)," ",win," ",max(winSeq),"\n")
ASNPS_chip$bootstrap[ASNPS_chip$V4 > win & ASNPS_chip$V4 <= (win+w_size) & ASNPS_chip$V1 == lg ] <-
(win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",max(winSeq)," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
ASNPS_ordered <- ASNPS_chip %>% filter(newSNPname != "" & NewScaff %in%  c(
"ScYP8k313HRSCAF58ch1"   , "ScYP8k312HRSCAF54ch1A"   , "ScYP8k3629HRSCAF770ch2" ,  "ScYP8k3866HRSCAF1020ch3" , "ScYP8k311HRSCAF50ch4","ScYP8k314HRSCAF84ch4A"  ,
"ScYP8k39HRSCAF32ch6" , "ScYP8k35HRSCAF18ch5"     , "ScYP8k34HRSCAF13ch7"   , "ScYP8k31HRSCAF1ch8"   ,  "ScYP8k33HRSCAF8ch9" , "ScYP8k32HRSCAF3ch10"   ,
"ScYP8k3869HRSCAF1023ch11",  "ScYP8k3870HRSCAF1029ch12",  "ScYP8k3302HRSCAF431ch13"  , "ScYP8k3651HRSCAF793ch14" ,  "ScYP8k3864HRSCAF1010ch15",
"ScYP8k37HRSCAF29ch17"   , "ScYP8k38HRSCAF31ch18"  ,  "ScYP8k36HRSCAF25ch19" ,"ScYP8k3865HRSCAF1011ch20",   "ScYP8k369HRSCAF175ch21" ,   "ScYP8k369HRSCAF175ch22"  ,
"ScYP8k369HRSCAF175ch23",  "ScYP8k369HRSCAF175ch24" , "ScYP8k369HRSCAF175ch25" ,"ScYP8k369HRSCAF175ch26", "ScYP8k369HRSCAF175ch27"  , "ScYP8k369HRSCAF175ch28"))
ASNPS_ordered$SNPpos <- as.numeric(ASNPS_ordered$SNPpos )
ASNPS_ordered <- ASNPS_ordered[order(ASNPS_ordered$NewScaff,ASNPS_ordered$SNPpos),]
bootstrap = 0
for(scaff in unique(ASNPS_ordered$NewScaff)){
bootstrap = min(ASNPS_ordered$bootstrap[ASNPS_ordered$NewScaff == scaff])
for(snp in ASNPS_ordered$SNPname){
if(ASNPS_ordered$NewScaff[ASNPS_ordered$SNPname == snp ] == scaff){
if( !is.na(ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff])){
bootstrap <- ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff]
}
if( is.na(ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff])){
ASNPS_ordered$bootstrap[ASNPS_ordered$SNPname == snp & ASNPS_ordered$NewScaff == scaff] <- bootstrap
}
}
}
}
A_bootstrap_map <- ASNPS_ordered %>% dplyr::select(SNPname,V1,NewScaff,V4,SNPpos,bootstrap)
names(A_bootstrap_map) <- c("SNP","linkage_group","scaff","cM","bp","bootstrap_cm")
View(A_bootstrap_map)
sizes <- read.table('working_files/FSJ.chrom.sizes')
A_bootstrap_ordered <- A_bootstrap_map[order(A_bootstrap_map$scaff,A_bootstrap_map$bp),]
w_size = 3400000
win_global = 0
for(scaf in unique(A_bootstrap_ordered$scaff)){
size_tmp <- sizes$V2[sizes$V1 == scaf]
for(win in seq(from=0,to=max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf],na.rm=T),by = w_size)){
if(win+w_size<size_tmp){
#cat(scaf, ((win/w_size) + win_global)," ",win," ",size_tmp,"\n")
A_bootstrap_ordered$bootstrap_bp[A_bootstrap_ordered$bp > win & A_bootstrap_ordered$bp <= (win+w_size) & A_bootstrap_ordered$scaff == scaf] <- (win/w_size) + win_global
}else{
cat( ((win/w_size) + win_global)," ",win," ",size_tmp," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
A_bootstrap_ordered <- A_bootstrap_map[order(A_bootstrap_map$scaff,A_bootstrap_map$bp),]
w_size = 3300000
win_global = 0
for(scaf in unique(A_bootstrap_ordered$scaff)){
size_tmp <- sizes$V2[sizes$V1 == scaf]
for(win in seq(from=0,to=max(A_bootstrap_ordered$bp[A_bootstrap_ordered$scaff == scaf],na.rm=T),by = w_size)){
if(win+w_size<size_tmp){
#cat(scaf, ((win/w_size) + win_global)," ",win," ",size_tmp,"\n")
A_bootstrap_ordered$bootstrap_bp[A_bootstrap_ordered$bp > win & A_bootstrap_ordered$bp <= (win+w_size) & A_bootstrap_ordered$scaff == scaf] <- (win/w_size) + win_global
}else{
cat(scaf, ((win/w_size) + win_global)," ",win," ",size_tmp," skipped\n")
}
}
win_global <- (win/w_size) + win_global + 1 #need to increase window number with each loop across chromosomes
}
badBoots_cm <- A_bootstrap_ordered %>% group_by(bootstrap_cm) %>% tally() %>% filter(n < 5)
badBoots_bp <- A_bootstrap_ordered %>% group_by(bootstrap_bp) %>% tally() %>% filter(n < 5)
badBoots_cm
badBoots_bp
A_bootstrap_ordered$bootstrap_cm[A_bootstrap_ordered$bootstrap_cm %in% badBoots_cm$bootstrap_cm] <- NA
A_bootstrap_ordered$bootstrap_bp[A_bootstrap_ordered$bootstrap_bp %in% badBoots_bp$bootstrap_bp] <- NA
write.table(A_bootstrap_ordered, file = paste("bootstrapMap.A.txt",sep=""),
append = F, quote = FALSE, sep = "\t",
eol = "\n", na = "NA", dec = ".", row.names = FALSE,
col.names = TRUE, qmethod = c("escape", "double"))
badBoots_cm
badBoots_bp
map<-read.table('bootstrapMap.A.txt',header=T)
map
map
map[,c(1,6)]
markersInPedOrder_chip_Z <- map[,c(1,6)] #%>% dplyr::select(SNP,bootstrap_cm)
w_size = 5
markersInPedOrder_chip_A <- map[,c(1,6)] #%>% dplyr::select(SNP,bootstrap_cm)
loop=1
unique(na.omit(markersInPedOrder_chip_A$bootstrap_cm))
win=481
cat(win,"\n")
#n = number of genotyped individuals, x = sample allele frequency
#calculate allele freq
sampleFreq<-data.frame(Year=rep(c(1999:2013),each=31),Category=rep(c(
'nt','xt','xt1-xt',
'nMs','xMs','nFs','xFs', 'xMs-xt','xFs-xt',
'nMi','xMi','nFi','xFi', 'xMi-xt','xFi-xt',
'nMb','xMb','nFb','xFb', 'xMb-xt','xFb-xt',
'xMdad','xFdad','xMmom','xFmom','xMfam','xFfam','xMmend','xFmend','xMfam-xt','xFfam-xt'),15),
stringsAsFactors=FALSE)
sampleFreq<-rbind(data.frame(Year=rep(1998,2),Category=c('nt','xt'),
stringsAsFactors=FALSE),sampleFreq)
SNPyr<-sampleFreq$Year
SNPcat<-sampleFreq$Category
